%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E8F4F8','primaryTextColor':'#2C3E50','primaryBorderColor':'#2C3E50','lineColor':'#34495E'}}}%%
flowchart TB
    Header["<b>WHY POSITION-AWARE F1 IS CRITICAL</b>"]

    Header --> Correct
    Header --> Wrong

    subgraph Correct["‚úÖ CORRECT: Position Alignment Maintained"]
        direction TB
        C1["<b>Extracted Fields (Debits Only):</b><br/>Date: ['16-Jul', '18-Jul', '20-Jul']<br/>Desc: ['EFTPOS Woolworths', 'EFTPOS Pizza Hut', 'Direct Debit - Utilities']<br/>Amount: ['45.20', '28.50', '127.80']"]
        C2["<b>Semantic Alignment Check:</b><br/><br/>Position[0]: 16-Jul ‚Üî Woolworths ‚Üî $45.20 ‚úì<br/><i>Woolworths purchase on 16-Jul for $45.20</i><br/><br/>Position[1]: 18-Jul ‚Üî Pizza Hut ‚Üî $28.50 ‚úì<br/><i>Pizza Hut purchase on 18-Jul for $28.50</i><br/><br/>Position[2]: 20-Jul ‚Üî Utilities ‚Üî $127.80 ‚úì<br/><i>Utilities payment on 20-Jul for $127.80</i>"]
        C3["<b>Position-Aware F1: 100%</b> ‚úÖ<br/><b>Position-Agnostic F1: 100%</b> ‚úÖ<br/><br/>Both metrics agree - extraction is correct!"]
        C1 --> C2 --> C3
    end

    subgraph Wrong["‚ùå WRONG: Dates Shuffled (Common Model Error)"]
        direction TB
        W1["<b>Extracted Fields (Dates Shuffled):</b><br/>Date: ['18-Jul', '16-Jul', '20-Jul'] ‚ùå<br/>Desc: ['EFTPOS Woolworths', 'EFTPOS Pizza Hut', 'Direct Debit - Utilities']<br/>Amount: ['45.20', '28.50', '127.80']"]
        W2["<b>Semantic Corruption Detected:</b><br/><br/>Position[0]: 18-Jul ‚Üî Woolworths ‚Üî $45.20 ‚ùå<br/><i>WRONG! Woolworths was on 16-Jul, not 18-Jul</i><br/><i>Pizza Hut was the 18-Jul transaction!</i><br/><br/>Position[1]: 16-Jul ‚Üî Pizza Hut ‚Üî $28.50 ‚ùå<br/><i>WRONG! Pizza Hut was on 18-Jul, not 16-Jul</i><br/><i>Woolworths was the 16-Jul transaction!</i><br/><br/>Position[2]: 20-Jul ‚Üî Utilities ‚Üî $127.80 ‚úì<br/><i>Only this position is correct</i>"]
        W3["<b>Position-Aware F1: 33%</b> ‚ö†Ô∏è<br/>‚úì Correctly detects misalignment (1/3 positions correct)<br/><br/><b>Position-Agnostic F1: 100%</b> ‚ùå<br/>‚úó FAILS to detect error (all values present)<br/><br/>üí• Data is semantically WRONG but scores 100%!"]
        W1 --> W2 --> W3
    end

    Conclusion["<b>üéØ CRITICAL INSIGHT FOR BANK STATEMENTS:</b><br/><br/>‚úÖ Position-Aware F1 detects semantic misalignment<br/>‚ùå Position-Agnostic F1 can score 100% on CORRUPT data<br/><br/>Each array index MUST represent the SAME transaction:<br/>Date[i] ‚Üî Description[i] ‚Üî Amount[i]<br/><br/>Use Position-Aware F1 (DEFAULT) for bank statement evaluation"]

    Correct -.Correct extraction.-> Conclusion
    Wrong -.Model error.-> Conclusion

    style Header fill:#E8F4F8,stroke:#2C3E50,stroke-width:3px
    style Correct fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style Wrong fill:#FFE6E6,stroke:#C73E1D,stroke-width:2px
    style C3 fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style W3 fill:#FFE6E6,stroke:#C73E1D,stroke-width:2px
    style Conclusion fill:#F0E6FF,stroke:#A23B72,stroke-width:3px
