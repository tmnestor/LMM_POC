%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E8F4F8','primaryTextColor':'#2C3E50','primaryBorderColor':'#2C3E50','lineColor':'#34495E'}}}%%
flowchart LR
    Data["<b>Example Data</b><br/>───────────<br/>Extracted: [banana, apple, cherry]<br/>Ground Truth: [apple, banana, cherry]"]

    Data --> PosAware
    Data --> PosAgnostic

    subgraph PosAware["🎯 Position-Aware F1 (Order Matters)"]
        direction TB
        PA1["<b>Position-by-Position Matching:</b><br/>Pos[0]: banana ≠ apple ❌ (FN)<br/>Pos[1]: apple ≠ banana ❌ (FN)<br/>Pos[2]: cherry = cherry ✓ (TP)"]
        PA2["<b>Counts:</b><br/>TP = 1, FP = 0, FN = 2"]
        PA3["<b>Metrics:</b><br/>Precision = 1/(1+0) = 1.0<br/>Recall = 1/(1+2) = 0.333<br/>F1 = 2×(1.0×0.333)/(1.0+0.333) = 0.50"]
        PA4["<b>Result: 50%</b> ⚠️"]
        PA1 --> PA2 --> PA3 --> PA4
    end

    subgraph PosAgnostic["🎲 Position-Agnostic F1 (Value Only)"]
        direction TB
        PNA1["<b>Set-Based Matching:</b><br/>banana → matches GT banana ✓ (TP)<br/>apple → matches GT apple ✓ (TP)<br/>cherry → matches GT cherry ✓ (TP)"]
        PNA2["<b>Counts:</b><br/>TP = 3, FP = 0, FN = 0"]
        PNA3["<b>Metrics:</b><br/>Precision = 3/(3+0) = 1.0<br/>Recall = 3/(3+0) = 1.0<br/>F1 = 2×(1.0×1.0)/(1.0+1.0) = 1.0"]
        PNA4["<b>Result: 100%</b> ✓"]
        PNA1 --> PNA2 --> PNA3 --> PNA4
    end

    PA4 -.-> Insight
    PNA4 -.-> Insight

    Insight["<b>💡 KEY INSIGHT:</b><br/>Same data, different scores!<br/><br/>Position-Aware = 50% (penalizes order error)<br/>Position-Agnostic = 100% (ignores order)<br/><br/>Choose based on whether order has semantic meaning"]

    style Data fill:#E8F4F8,stroke:#2C3E50,stroke-width:3px
    style PosAware fill:#FFF4E6,stroke:#F18F01,stroke-width:2px
    style PosAgnostic fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style PA4 fill:#FFF4E6,stroke:#F18F01,stroke-width:2px
    style PNA4 fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style Insight fill:#F0E6FF,stroke:#A23B72,stroke-width:3px
