# Define list of questions to test
questions = [
    """What debit transactions occurred on **25 Sep, 2023**?""",
    """If multiple transactions are GROUPED under a common date respond with "Date-grouped",
    BUT if every transaction has a clearly identified date at the start of its OWN row respond with "Date-per-row".
    Response:""",
    """Is the transaction table "Date Grouped"?""",
    """What are the date, details, debits, credits, and balance of the first transaction?
    If any of these values are unknown, you must use "NOT_FOUND" in your answer""",
    """What debit transactions occurred on **Thur 21 Aug, 2025**?""",
]

# Store results for analysis
results = []

# Process each question
for idx, prompt in enumerate(questions, 1):
    print("\n" + "=" * 60)
    print(f"QUESTION {idx}/{len(questions)}:")
    print("=" * 60)
    print(prompt)
    print("=" * 60 + "\n")

    # CRITICAL: Create FRESH message structure (independent turn)
    messageDataStructure_format = [
        {
            "role": "user",
            "content": [{"type": "image"}, {"type": "text", "text": prompt}],
        }
    ]

    print(f"ðŸ’¬ Processing question {idx}...")
    print("ðŸ¤– Generating response with Llama-3.2-Vision...")

    # Process with FRESH context
    textInput = processor.apply_chat_template(
        messageDataStructure_format, add_generation_prompt=True
    )

    inputs = processor(images=images, text=textInput, return_tensors="pt").to(
        model.device
    )

    output = model.generate(
        **inputs,
        max_new_tokens=100,
        do_sample=False,
        temperature=None,
        top_p=None,
    )

    generate_ids = output[:, inputs["input_ids"].shape[1] : -1]
    format_response = processor.decode(
        generate_ids[0], clean_up_tokenization_spaces=False
    ).strip()

    print("\n" + "=" * 60)
    print(f"âœ… RESPONSE {idx}:")
    print("=" * 60)
    print(format_response)
    print("=" * 60)

    # Store result
    results.append(
        {"question_num": idx, "question": prompt, "response": format_response}
    )

# Summary of all results
print("\n" + "=" * 80)
print("SUMMARY - ALL QUESTIONS AND RESPONSES:")
print("=" * 80)
for result in results:
    print(f"\nQ{result['question_num']}: {result['question'][:60]}...")
    print(f"A{result['question_num']}: {result['response']}")
    print("-" * 80)
