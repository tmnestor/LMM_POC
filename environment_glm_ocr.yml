name: glm_ocr
channels:
  - pytorch
  - nvidia
  - conda-forge
  - defaults
dependencies:
  - python=3.12
  - pandas
  - seaborn
  - matplotlib
  - rich
  - pip
  - pytorch::pytorch>=2.0.0
  - pytorch::torchvision>=0.15.0
  # pytorch-cuda=12.6 on GPU servers; omitted for macOS ARM64
  - numpy>=1.24.0
  - pip:
    # GLM-OCR requires latest transformers from source
    - git+https://github.com/huggingface/transformers.git
    - pillow>=10.0.0
    - accelerate>=0.27.0
    - pyyaml>=6.0.0
    - typer>=0.9.0
    - jupyter>=1.0.0
    - ipython>=8.0.0
    - ipykernel

# =====================================================
# ENVIRONMENT SETUP
# =====================================================
#
# Create:
#   conda env create -f environment_glm_ocr.yml
#
# Activate:
#   conda activate glm_ocr
#
# Update:
#   conda env update -f environment_glm_ocr.yml --prune
#
# Install FlashAttention (optional, GPU only):
#   pip install flash-attn --no-build-isolation
#
# Verify:
#   python -c "import transformers; print(f'Transformers: {transformers.__version__}')"
#   python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"
#
# =====================================================
# NOTES
# =====================================================
# - GLM-OCR (0.9B params) uses AutoProcessor + AutoModelForImageTextToText
# - Requires latest transformers from GitHub (not PyPI release)
# - No trust_remote_code needed
# - Supports torch_dtype="auto" and device_map="auto"
# - MIT license (model) + Apache 2.0 (PP-DocLayoutV3)
